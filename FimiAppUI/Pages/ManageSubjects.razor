@page "/Pages/ManageSubjects"

@inherits ManageSubjectsBase

<PageTitle>Subjects</PageTitle>

<MudGrid Class="mt-n16 px-5" Style="@($"background:#ffffff;")">
    <MudItem xs="9">
        <MudText Typo="Typo.h5" Class="d-flex pt-2 justify-start"><b>Manage Subjects</b></MudText>
    </MudItem>
    <MudItem xs="3" Class="d-flex justify-end">
        <MudIconButton Icon="@Icons.Material.Filled.Message" Color="Color.Inherit" Edge="Edge.End" />
        <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="Color.Inherit" Edge="Edge.End" />
    </MudItem>
</MudGrid>
<MudDivider DividerType="DividerType.FullWidth" />

<MudTabs Elevation="0" ApplyEffectsToContainer="true" Border="true" Color="Color.Surface">
    <MudTabPanel Text="All Subjects">
        <MudGrid Class="d-flex pa-4">
            <MudItem xs="12">
                @if (SubjectsWithCategories is null )
                {
                    <MudProgressLinear Color="Color.Tertiary" Size="Size.Small" Indeterminate="true" Class="mt-4" />
                }
                else
                {
                    <MudTable Bordered="true" Elevation="0" Items="@SubjectsWithCategories" FixedHeader="@fixed_header" Hover="true" SortLabel="Sort By" Striped="true" Dense="true" RowsPerPage="15">
                        <HeaderContent>
                            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<SubjectModel, object>(x=>x.Code)">Code</MudTableSortLabel></MudTh>
                            <MudTh>Category</MudTh>
                            <MudTh>Subject</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Code">@context.Code</MudTd>
                            <MudTd DataLabel="SubjectCategory">@context.SubjectCategory.SubjectCategoryName</MudTd>
                            <MudTd DataLabel="SubjectName">@context.SubjectName</MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager />
                        </PagerContent>
                    </MudTable>
                }
            </MudItem>
        </MudGrid>
    </MudTabPanel>
    <MudTabPanel Text="Assign Teacher">
        <MudGrid Class="pa-4">
            <MudItem xs="3">
                <MudCard Style="width:250px" Elevation="0">
                    <MudCardContent Class="ma-2">
                        <MudAutocomplete T="TeacherModel" Label="Select Teacher" @bind-Value="SelectedTeacherOnAssignTeacherTab" ShowProgressIndicator="true"
                                         SearchFunc="@TeacherSearchOnAssignTeacherTab"
                                         ToStringFunc="@(e=> e==null?null : $"{e.Staff.FirstName} {e.Staff.MiddleName} {e.Staff.Surname}")"/>
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" FullWidth="true" OnClick="@GetTeacher" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" Style="background-color:#8F2D56">Submit</MudButton>
                    </MudCardActions>
                </MudCard>
                <MudCard Style="width:250px" Class="ma-2"Elevation="0">
                    <MudCardContent>
                        <MudAutocomplete T="SubjectModel" Label="Assign Subject" @bind-Value="SelectedSubjectOnAssignTeacherTab" ShowProgressIndicator="true"
                                         SearchFunc="@SubjectSearchOnAssignTeacherTab" ToStringFunc="@(e=> e==null?null : $"{e.SubjectName}")" />
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" FullWidth="true" OnClick="@AssignClassTeacher" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" Style="background-color:#8F2D56">Submit</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
            <MudDivider Vertical="true" FlexItem="true" />
            <MudItem xs="6">
                @if (showTeacherSubject)
                {
                    <MudCard Class="ma-2" Elevation="0">
                        <MudCardContent>
                            <MudText Typo="Typo.h6">@TeacherSubjects.FirstOrDefault().Teacher.Staff.FirstName @TeacherSubjects.FirstOrDefault().Teacher.Staff.MiddleName @TeacherSubjects.FirstOrDefault().Teacher.Staff.Surname</MudText>
                        </MudCardContent>
                    </MudCard>
                    <MudTable Bordered="true" Elevation="0" Class="ma-2" Items="@TeacherSubjects" Hover="true" SortLabel="Sort By" Striped="true" Dense="true">
                        <HeaderContent>
                            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<TeacherSubjectModel, object>(x=>x.Code)">Code</MudTableSortLabel></MudTh>
                            <MudTh>Category</MudTh>
                            <MudTh>Subject</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Code">@context.Code</MudTd>
                            <MudTd DataLabel="SubjectCategory">@context.Subject.SubjectCategory.SubjectCategoryName</MudTd>
                            <MudTd DataLabel="SubjectName">@context.Subject.SubjectName</MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager />
                        </PagerContent>
                    </MudTable>
                }
            </MudItem>
        </MudGrid>
    </MudTabPanel>
    <MudTabPanel Text="Subject Selection">
        <MudGrid Class="d-flex pa-4">
            <MudItem xs="3">
                <MudCard Class="ma-2" Style="width:250px" Elevation="0">
                    <MudCardContent>
                        <MudNumericField @bind-Value="StudentNumber" Label="Admission number" Variant="Variant.Outlined" />
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" FullWidth="true" OnClick="@GetStudent" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" Style="background-color:#8F2D56">Submit</MudButton>
                    </MudCardActions>
                </MudCard>
                <MudCard Class="ma-2" Style="width:250px" Elevation="0">
                    <MudCardContent>
                        <MudAutocomplete T="SubjectModel" Label="Sciences" @bind-Value="SelectedScience" ShowProgressIndicator="true"
                                         SearchFunc="@ScienceSearchOnSelectionTab" ToStringFunc="@(e=> e==null?null : $"{e.SubjectName}")" />
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" FullWidth="true" OnClick="@ScienceSelection" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" Style="background-color:#8F2D56">Submit</MudButton>
                    </MudCardActions>
                </MudCard>
                <MudCard Class="ma-2" Style="width:250px" Elevation="0">
                    <MudCardContent>
                        <MudAutocomplete T="SubjectModel" Label="Humanities" @bind-Value="SelectedHumanity" ShowProgressIndicator="true"
                                         SearchFunc="@HumanitySearchOnSelectionTab" ToStringFunc="@(e=> e==null?null : $"{e.SubjectName}")" />
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" FullWidth="true" OnClick="@HumanitySelection" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" Style="background-color:#8F2D56">Submit</MudButton>
                    </MudCardActions>
                </MudCard>
                <MudCard Class="ma-2" Style="width:250px" Elevation="0">
                    <MudCardContent>
                        <MudAutocomplete T="SubjectModel" Label="Technicals" @bind-Value="SelectedTechnical" ShowProgressIndicator="true"
                                         SearchFunc="@TechnicalSearchOnSelectionTab" ToStringFunc="@(e=> e==null?null : $"{e.SubjectName}")" />
                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" FullWidth="true" OnClick="@TechnicalSelection" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Save" Style="background-color:#8F2D56">Submit</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
            <MudDivider Vertical="true" FlexItem="true" />
            <MudItem xs="6">
                @if (StudentSubjects is null)
                {
                    <MudProgressLinear Color="Color.Tertiary" Size="Size.Small" Indeterminate="true" Class="mt-4" />
                }
                else if (showTable is true)
                {
                    <MudCard Class="ma-2" Elevation="0">
                        <MudCardContent>
                            <MudText Typo="Typo.h6">@Student.FirstName @Student.MiddleName @Student.Surname</MudText>
                        </MudCardContent>
                    </MudCard>
                    <MudTable Bordered="true" Elevation="0" Class="ma-2" Items="@StudentSubjects" FixedHeader="@fixed_header" Hover="true" SortLabel="Sort By" Striped="true" Dense="true" RowsPerPage="15">
                        <HeaderContent>
                            <MudTh><MudTableSortLabel InitialDirection="SortDirection.Ascending" SortBy="new Func<SubjectModel, object>(x=>x.Code)">Code</MudTableSortLabel></MudTh>
                            <MudTh>Category</MudTh>
                            <MudTh>Subject</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Code">@context.Code</MudTd>
                            <MudTd DataLabel="SubjectCategory">@context.Subject.SubjectCategory.SubjectCategoryName</MudTd>
                            <MudTd DataLabel="SubjectName">@context.Subject.SubjectName</MudTd>
                        </RowTemplate>
                        <PagerContent>
                            <MudTablePager />
                        </PagerContent>
                    </MudTable>
                }
            </MudItem>
        </MudGrid>
    </MudTabPanel>
</MudTabs>



                    